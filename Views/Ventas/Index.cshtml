@model List<MusikWebApp.Models.Ventas>

@{
    ViewData["Title"] = "Administración de Ventas";
    Layout = "_LayoutAdmin";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">🛒 Lista de Ventas</h2>
                <div>
                    <span class="badge bg-primary fs-6">Total: @Model.Count ventas</span>
                </div>
            </div>
            
            @if (!Model.Any())
            {
                <div class="alert alert-info text-center" role="alert">
                    <div class="mb-3">
                        <i class="fas fa-chart-line" style="font-size: 3rem; color: #6c757d;"></i>
                    </div>
                    <h4>No hay ventas registradas</h4>
                    <p>Las ventas aparecerán aquí cuando los usuarios realicen compras.</p>
                </div>
            }
            else
            {
                <!-- Estadísticas rápidas -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card bg-primary text-white">
                            <div class="card-body text-center">
                                <h5>@Model.Count</h5>
                                <small>Total Ventas</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-success text-white">
                            <div class="card-body text-center">
                                <h5>@Model.Count(v => v.confirmada)</h5>
                                <small>Confirmadas</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-warning text-white">
                            <div class="card-body text-center">
                                <h5>@Model.Count(v => !v.confirmada)</h5>
                                <small>Pendientes</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card bg-info text-white">
                            <div class="card-body text-center">
                                <h5>$@Model.Sum(v => v.precioTotal).ToString("N2")</h5>
                                <small>Total Ingresos</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tabla de ventas -->
                <div class="card shadow-sm">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">📋 Lista Completa de Ventas</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>ID Venta</th>
                                        <th>Usuario</th>
                                        <th>Fecha</th>
                                        <th class="text-center">Total</th>
                                        <th class="text-center">Método</th>
                                        <th class="text-center">Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var venta in Model.OrderByDescending(v => v.fecha_venta))
                                    {
                                        <tr>
                                            <td>
                                                <strong class="text-primary">#@venta.id_venta</strong>
                                            </td>
                                            <td>
                                                @{
                                                    var nombreUsuario = "Usuario desconocido";
                                                    if (ViewBag.Usuarios != null && ((Dictionary<long, string>)ViewBag.Usuarios).ContainsKey(venta.usuario.id_usuario))
                                                    {
                                                        nombreUsuario = ((Dictionary<long, string>)ViewBag.Usuarios)[venta.usuario.id_usuario];
                                                    }
                                                }
                                                <div>
                                                    <strong>@nombreUsuario</strong>
                                                </div>
                                                <small class="text-muted">ID: @venta.usuario.id_usuario</small>
                                            </td>
                                            <td>
                                                <div>
                                                    <strong>@venta.fecha_venta.ToString("dd/MM/yyyy")</strong>
                                                </div>
                                                <small class="text-muted">@venta.fecha_venta.ToString("HH:mm")</small>
                                            </td>
                                            <td class="text-center">
                                                <span class="fw-bold text-success">$@venta.precioTotal.ToString("N2")</span>
                                            </td>
                                            <td class="text-center">
                                                @{
                                                    var nombreMetodo = "Método desconocido";
                                                    if (ViewBag.MetodosPago != null && ((Dictionary<long, string>)ViewBag.MetodosPago).ContainsKey(venta.metodoPago.id_metodoPago))
                                                    {
                                                        nombreMetodo = ((Dictionary<long, string>)ViewBag.MetodosPago)[venta.metodoPago.id_metodoPago];
                                                    }
                                                }
                                                <span class="badge bg-secondary">@nombreMetodo</span>
                                            </td>
                                            <td class="text-center">
                                                @if (venta.confirmada)
                                                {
                                                    <span class="badge bg-success">✅ Confirmada</span>
                                                }
                                                else
                                                {
                                                    <span class="badge bg-warning">⏳ Pendiente</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card-footer bg-light">
                        <div class="row">
                            <div class="col-md-6">
                                <small class="text-muted">
                                    <i class="fas fa-info-circle"></i> 
                                    Mostrando @Model.Count ventas totales
                                </small>
                            </div>
                            <div class="col-md-6 text-end">
                                <small class="text-muted">
                                    <i class="fas fa-calculator"></i> 
                                    Ingresos totales: $@Model.Sum(v => v.precioTotal).ToString("N2")
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
}